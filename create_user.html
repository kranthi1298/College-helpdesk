


<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>College Helpdesk - Create User</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes slideInLeft {
            0% { transform: translateX(-100%); opacity: 0; }
            100% { transform: translateX(0); opacity: 1; }
        }

        @keyframes slideInRight {
            0% { transform: translateX(100%); opacity: 0; }
            100% { transform: translateX(0); opacity: 1; }
        }

        @keyframes fadeIn {
            0% { opacity: 0; }
            100% { opacity: 1; }
        }

        .animate-slide-left {
            animation: slideInLeft 0.8s ease-out forwards;
        }

        .animate-slide-right {
            animation: slideInRight 0.8s ease-out forwards;
        }

        .animate-fade-in {
            animation: fadeIn 1s ease-in forwards;
        }

        .bg-image-section {
            background-image: url('https://images.unsplash.com/photo-1516321318426-8d4d6f3a6f5b?ixlib=rb-4.0.3&auto=format&fit=crop&w=1350&q=80');
            background-size: cover;
            background-position: center;
        }

        .overlay {
            background-color: rgba(0, 0, 0, 0.5);
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center bg-gray-100 font-sans">
    <div class="w-full max-w-4xl flex rounded-2xl shadow-2xl overflow-hidden m-4">
        
        <div class="w-1/2 bg-image-section text-white p-8 flex flex-col justify-center overlay animate-slide-left hidden md:flex">
            <h2 class="text-4xl font-bold mb-4"> Hello!</h2>
            <h1 class="text-5xl font-extrabold mb-6">Create Account</h1>
            <p class="text-lg mb-8">Join our community today! Whether you're a student or staff, we're here to help you succeed. Let's get started on your journey.</p>
            <button class="bg-teal-500 hover:bg-teal-600 text-white font-semibold py-3 px-6 rounded-lg transition-all duration-300 w-fit animate-fade-in">Get Started</button>
        </div>

       
        <div class="w-full md:w-1/2 bg-white p-8 flex flex-col justify-center animate-slide-right">
            <h2 class="text-3xl font-bold text-gray-800 mb-2">Join Us</h2>
            <p class="text-gray-600 mb-6">Create your account, it's free.</p>
            <form id="createUserForm" class="space-y-4">
                <div class="space-y-2">
                    <input type="text" id="userId" name="userId" placeholder="User ID" required pattern="[0-9]+" title="Please enter only numbers" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 transition-all duration-300">
                    <small class="text-gray-500 text-sm">Enter numeric ID (e.g., 123456)</small>
                </div>
                <div class="space-y-2">
                    <input type="text" id="fullName" name="fullName" placeholder="Full Name" required class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 transition-all duration-300">
                </div>
                <div class="space-y-2">
                    <input type="email" id="email" name="email" placeholder="Email" required class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 transition-all duration-300">
                    <small class="text-gray-500 text-sm">Must be a valid email (e.g., user@college.edu)</small>
                </div>
                <div class="space-y-2">
                    <input type="password" id="password" name="password" placeholder="Password" required minlength="8" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 transition-all duration-300">
                    <small class="text-gray-500 text-sm">Minimum 8 characters</small>
                </div>
                <div class="space-y-2">
                    <label for="roleSelect" class="sr-only">Role</label>
                    <select id="roleSelect" name="role" required class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 transition-all duration-300">
                        <option value="" disabled selected>Select Role</option>
                        <option value="student">Student</option>
                        <option value="staff">Staff</option>
                    </select>
                </div>
                <div class="space-y-2 hidden" id="yearGroup">
                    <label for="year" class="sr-only">Year</label>
                    <select id="year" name="year" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 transition-all duration-300">
                        <option value="" disabled selected>Select Year</option>
                        <option value="1">1st Year</option>
                        <option value="2">2nd Year</option>
                        <option value="3">3rd Year</option>
                        <option value="4">4th Year</option>
                    </select>
                </div>
                <div class="space-y-2">
                    <label for="department" class="sr-only">Department</label>
                    <select id="department" name="department" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 transition-all duration-300">
                        <option value="">Select Department</option>
                        <option value="IT">IT</option>
                        <option value="CSE">CSE</option>
                        <option value="ECE">ECE</option>
                        <option value="Mechanical">Mechanical</option>  
                        <option value="Civil">Civil</option>    
                        <option value="Electrical">Electrical</option>
                        <option value="Library">Library</option>
                        <option value="Facilities">Facilities</option>
                        <option value="Academics">Academics</option>
                        <option value="Administration">Administration</option>
                        <option value="sports">Sports</option>
                        <option value="H&S">H&S</option>
                    </select>
                </div>
                <div class="flex items-center">
                    <input type="checkbox" id="terms" class="mr-2">
                    <label for="terms" class="text-gray-600 text-sm">I agree to <a href="#" class="text-teal-500 hover:underline">Conditions of Use & Privacy</a></label>
                </div>
                <button type="submit" class="w-full bg-gray-800 hover:bg-gray-900 text-white font-semibold py-3 rounded-lg transition-all duration-300 animate-fade-in">Create Account</button>
            </form>
            <p class="text-center text-gray-500 text-sm mt-4">Â© 2025 College Helpdesk. All rights reserved.</p>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
        
            if (isAdminAuthenticated()) {
                window.location.href = 'admin_login.html';
                return;
            }

          
            let users = getStoredData('helpdeskUsers') || [];
            let activityLog = getStoredData('activityLog') || [];

            const roleSelect = document.getElementById('roleSelect');
            const yearGroup = document.getElementById('yearGroup');
            const yearSelect = document.getElementById('year');

         
            roleSelect.addEventListener('change', function() {
                if (this.value === 'student') {
                    yearGroup.classList.remove('hidden');
                    yearSelect.required = true;
                } else {
                    yearGroup.classList.add('hidden');
                    yearSelect.required = false;
                    yearSelect.value = '';
                }
            });

         
            document.getElementById('createUserForm').addEventListener('submit', function(e) {
                e.preventDefault();

                const userId = document.getElementById('userId').value.trim();
                const fullName = document.getElementById('fullName').value.trim();
                const email = document.getElementById('email').value.trim();
                const role = document.getElementById('roleSelect').value;
                const password = document.getElementById('password').value;
                const department = document.getElementById('department').value;
                const year = role === 'student' ? document.getElementById('year').value : null;
                const terms = document.getElementById('terms').checked;

               
                if (!userId || !fullName || !email || !role || !password) {
                    alert('Please fill in all required fields');
                    return;
                }

                if (role === 'student' && !year) {
                    alert('Please select a year for student');
                    return;
                }

                if (!terms) {
                    alert('Please agree to the Conditions of Use & Privacy');
                    return;
                }

                if (!/^\d+$/.test(userId)) {
                    alert('User ID must contain only numbers');
                    return;
                }

                if (!validateEmail(email)) {
                    alert('Please enter a valid email address');
                    return;
                }

                if (password.length < 8) {
                    alert('Password must be at least 8 characters long');
                    return;
                }

                if (users.some(user => user.email.toLowerCase() === email.toLowerCase())) {
                    alert('A user with this email already exists');
                    return;
                }

                if (users.some(user => user.id === userId)) {
                    alert('This user ID is already in use');
                    return;
                }

                
                const newUser = {
                    id: userId,
                    name: fullName,
                    email: email,
                    role: role,
                    password: hashPassword(password),
                    department: department,
                    year: year,
                    dateCreated: new Date().toISOString(),
                    isActive: true,
                    lastLogin: null,
                    permissions: getDefaultPermissions(role)
                };

               
                users.push(newUser);
                saveStoredData('helpdeskUsers', users);

                
                const logMessage = role === 'student'
                    ? `Created new ${role} account for ${fullName} with ID ${userId} (Year ${year})`
                    : `Created new ${role} account for ${fullName} with ID ${userId}`;
                addActivityLog(logMessage);

                saveUsersToCSV(users);

               
                alert('User created successfully!');
                setTimeout(() => {
                    window.location.href = 'admin_dashboard.html';
                }, 2000);
            });

            
            function saveUsersToCSV(users) {
                try {
                    let csvContent = "ID,Name,Email,Role,Department,Year,DateCreated,IsActive\n";
                    users.forEach(user => {
                        csvContent += `"${user.id}","${user.name}","${user.email}","${user.role}","${user.department || ''}","${user.year || ''}","${user.dateCreated}","${user.isActive}"\n`;
                    });
                    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                    const link = document.createElement('a');
                    const url = URL.createObjectURL(blob);
                    link.setAttribute('href', url);
                    link.setAttribute('download', 'users_data.csv');
                    link.style.visibility = 'hidden';
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    localStorage.setItem('usersCSVData', csvContent);
                } catch (e) {
                    console.error('Error generating CSV:', e);
                }
            }

           
            function isAdminAuthenticated() {
                const authToken = sessionStorage.getItem('adminAuthToken');
                const expiry = sessionStorage.getItem('authExpiry');
                if (!authToken || !expiry) return false;
                if (new Date().getTime() > parseInt(expiry)) {
                    secureLogout();
                    return false;
                }
                return true;
            }

            function secureLogout() {
                sessionStorage.removeItem('adminAuthToken');
                sessionStorage.removeItem('authExpiry');
                sessionStorage.removeItem('isAdminLoggedIn');
            }

            function getStoredData(key) {
                try {
                    const data = localStorage.getItem(key);
                    return data ? JSON.parse(data) : null;
                } catch (e) {
                    console.error('Error reading data:', e);
                    return null;
                }
            }

            function saveStoredData(key, data) {
                try {
                    localStorage.setItem(key, JSON.stringify(data));
                } catch (e) {
                    console.error('Error saving data:', e);
                }
            }

            function hashPassword(password) {
                return 'hashed_' + btoa(unescape(encodeURIComponent(password + '_STATIC_SALT')));
            }

            function validateEmail(email) {
                const regex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                return regex.test(email);
            }

            function getDefaultPermissions(role) {
                const permissions = {
                    dashboard: true,
                    tickets: true
                };
                switch (role) {
                    case 'staff':
                        permissions.users = false;
                        permissions.createUser = false;
                        permissions.manageSystem = false;
                        break;
                    case 'student':
                        permissions.users = false;
                        permissions.createUser = false;
                        permissions.manageSystem = false;
                        permissions.tickets = true;
                        break;
                }
                return permissions;
            }

            function addActivityLog(action) {
                activityLog.push({
                    action: action,
                    timestamp: new Date().toISOString()
                });
                if (activityLog.length > 50) {
                    activityLog.shift();
                }
                saveStoredData('activityLog', activityLog);
            }
        });
    </script>
</body>
</html>
